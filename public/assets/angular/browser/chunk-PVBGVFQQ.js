import{b as A}from"./chunk-T7MMBD4M.js";import{b as G}from"./chunk-DQFC7UUZ.js";import{b as h,d as l,f as v,g as w,h as C,j as m,l as x,n as y,o as F,w as S}from"./chunk-5WDFAQTY.js";import{a as M}from"./chunk-VJJHPCLK.js";import"./chunk-T3OGVFXZ.js";import"./chunk-LAM6RKH7.js";import"./chunk-TS2YMWJE.js";import{$b as P,Lb as q,Nb as r,Oa as u,Z as f,Za as c,ac as D,fc as b,mb as E,nb as L,sb as d,tb as i,ub as t,vb as a,yb as g,zb as R}from"./chunk-B42WC262.js";import"./chunk-4IDNTCH7.js";var _=class n{submitFunction=b(()=>{});loginForm=new C({email:new m("",{validators:l.required,nonNullable:!0}),password:new m("",{validators:l.required,nonNullable:!0})});onSubmit(){if(this.loginForm.invalid)return;let o=this.loginForm.value;this.submitFunction()(o)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=c({type:n,selectors:[["app-login-presenter"]],inputs:{submitFunction:[1,"submitFunction"]},decls:12,vars:1,consts:[[1,"form-container","max-w-lg","mx-auto","p-6","bg-white","rounded-lg","shadow-md","mb-2"],[3,"ngSubmit","formGroup"],[1,"form-field","mb-1"],["for","email"],["type","email","id","email","formControlName","email",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","password"],["type","password","id","password","formControlName","password",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["type","submit",1,"w-full","mt-2","py-2","bg-blue-600","text-white","font-semibold","rounded-lg","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","transition","ease-in-out","duration-150"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"form",1),g("ngSubmit",function(){return s.onSubmit()}),i(2,"div",2)(3,"label",3),r(4,"Email:"),t(),a(5,"input",4),t(),i(6,"div",2)(7,"label",5),r(8,"Password:"),t(),a(9,"input",6),t(),i(10,"button",7),r(11," Login "),t()()()),e&2&&(u(),d("formGroup",s.loginForm))},dependencies:[S,x,h,v,w,y,F],encapsulation:2})};var N=class n{submitFunction=b(()=>{});registerForm=new C({email:new m("",{validators:[l.required,l.email],nonNullable:!0}),password:new m("",{validators:l.required,nonNullable:!0}),first_name:new m("",{validators:l.required,nonNullable:!0}),last_name:new m("",{validators:l.required,nonNullable:!0})});onSubmit(){if(this.registerForm.invalid)return;let o=this.registerForm.value;this.submitFunction()(o)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=c({type:n,selectors:[["app-register-presenter"]],inputs:{submitFunction:[1,"submitFunction"]},decls:20,vars:3,consts:[[1,"form-container","max-w-lg","mx-auto","p-6","bg-white","rounded-lg","shadow-md","mb-2"],[3,"ngSubmit","formGroup"],[1,"form-field","mb-1"],["for","first_name"],["type","text","id","first_name","formControlName","first_name",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","last_name"],["type","text","id","last_name","formControlName","last_name",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","email"],["type","email","id","email","formControlName","email",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","password"],["type","password","id","password","formControlName","password",1,"mt-2","w-full","text-center","px-2","py-1","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["type","submit",1,"w-full","mt-2","py-2","bg-blue-600","text-white","font-semibold","rounded-lg","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","transition","ease-in-out","duration-150"]],template:function(e,s){if(e&1&&(i(0,"div",0)(1,"form",1),g("ngSubmit",function(){return s.onSubmit()}),i(2,"div",2)(3,"label",3),r(4,"First name:"),t(),a(5,"input",4),t(),i(6,"div",2)(7,"label",5),r(8,"Last name:"),t(),a(9,"input",6),t(),i(10,"div",2)(11,"label",7),r(12,"Email:"),t(),a(13,"input",8),t(),i(14,"div",2)(15,"label",9),r(16,"Password:"),t(),a(17,"input",10),t(),i(18,"button",11),r(19," Register "),t()()()),e&2){let p;u(),d("formGroup",s.registerForm),u(12),q("border-red-500",((p=s.registerForm.get("email"))==null?null:p.touched)&&((p=s.registerForm.get("email"))==null?null:p.invalid))}},dependencies:[S,x,h,v,w,y,F],encapsulation:2})};function I(n,o){if(n&1&&(i(0,"h2",1),r(1,"Login as existing user"),t(),a(2,"app-login-presenter",2)),n&2){let e=R();u(2),d("submitFunction",e.handleLogin)}}function j(n,o){if(n&1&&(i(0,"h2",1),r(1,"Register new user"),t(),a(2,"app-register-presenter",2)),n&2){let e=R();u(2),d("submitFunction",e.handleRegister)}}function k(n,o){n&1&&(i(0,"p",0),r(1,"Logging out..."),t())}var V=class n{authService=f(A);router=f(G);notification=f(M);mode=P(()=>{switch(this.router.url){case"/auth/register":return"register";case"/auth/logout":return"logout";default:return"login"}});logoutEffect=D(()=>{this.mode()==="logout"&&this.authService.logout().subscribe({next:()=>{this.notification.showSuccess("Logout successful"),this.router.navigateByUrl("auth/login")},error:()=>{console.warn("Error posting to logout endpoint"),this.router.navigateByUrl("auth/login")}})});handleLogin=o=>{this.authService.login(o).subscribe({next:()=>{this.notification.showSuccess("Login successful"),this.router.navigateByUrl("home")},error:e=>{e.status===401&&this.notification.showError("Login failed, wrong password or email")}})};handleRegister=o=>{this.authService.register(o).subscribe({next:()=>{this.router.navigateByUrl("auth/login"),this.notification.showSuccess("Registration successful")},error:()=>{this.notification.showError("Registration failed")}})};static \u0275fac=function(e){return new(e||n)};static \u0275cmp=c({type:n,selectors:[["app-auth-container"]],decls:3,vars:1,consts:[[1,"text-center","mt-8","text-gray-500"],[1,"text-2xl","font-semibold","text-gray-800","mb-4","mt-4","text-center"],[3,"submitFunction"]],template:function(e,s){e&1&&E(0,I,3,1)(1,j,3,1)(2,k,2,0,"p",0),e&2&&L(s.mode()==="login"?0:s.mode()==="register"?1:s.mode()==="logout"?2:-1)},dependencies:[_,N],encapsulation:2})};export{V as AuthContainerComponent};
